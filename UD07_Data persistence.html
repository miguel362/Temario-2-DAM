<!DOCTYPE html>
<!-- saved from url=(0081)https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#practice5 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data persistence</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://sdram58.github.io/apuntesPMDM/favicon.ico">
    <link rel="stylesheet" href="./Data persistence_files/prism.css">
    <link rel="stylesheet" href="./Data persistence_files/styles.css">
    <script src="./Data persistence_files/script.js.descarga"></script>
</head>
<body class="line-numbers">
    <h1>Data persistence</h1>
    <div class="main-menu">
        <div class="fila">
            <a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#sSaveState">Save State</a><a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#sFileSystem">File System</a><a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#sShared">Shared Preferences</a>
        </div>
        <div class="fila">
            <a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#sRoom">Room</a><a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html#sWebgrafia">Webgraphy</a>
           <a href="https://sdram58.github.io/apuntesPMDM/unidades2223/ud7_persistence.html" class="relleno"></a>
        </div>
        
    </div>

    <!--*********************************************************OnSaveState***********************************************************-->
    <section class="apartado">
    <a name="sSaveState"></a>
    <h2>Save State</h2>
    
    <p>In this section, we’ll be discussing the two vital methods for managing the state of the application, namely <span class="r-word">onSaveInstanceState</span> 
         and <span class="r-word">onRestoreInstanceState</span>.</p>
         
    <p>We’ll be developing a <span class="d-word">Counter</span>  Android Application in which we’ll handle the state of the application when the configuration changes.</p>
         
    <p>So, let's get started.</p>
    
    <h3>Creating the App</h3>

    <p>Create an App called <span class="d-word">SaveState</span> from <span class="negrita">empty activity</span> which contains only a <span class="negrita">TextView</span>  
        and a <span class="negrita">Button</span></p>

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">activity_main.xml</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tvCounter<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/purple_500<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40sp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">tools:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.25<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/btnInc<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Increase<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textAllCaps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/tvCounter<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.50<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section><br><br>
    </section>

    <p>Now we go with the code of the <span class="inline-file">MainActivity.kt</span>. It will simply have a <span class="subrayado">listener</span>  so that when the
         button is pressed, the counter increases by 1. For this we will have a global variable <span class="d-word">counter</span>  that we will initialize to <span class="negrita">0</span> 
          and that we will increase each time we press the button. It's an easy app but it serves us for that example.</p>

    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
        </section>
    <section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView

<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> counter<span class="token operator">=</span><span class="token number">0</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> tvCounter<span class="token operator">:</span> TextView <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tvCounter<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> btnInc<span class="token operator">:</span> Button <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btnInc<span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>



        btnInc<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token function">increaseCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">increaseCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">++</span>

        <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tvCounter<span class="token punctuation">.</span>text<span class="token operator">=</span>counter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>
    </section>
    
    <figure><img src="./Data persistence_files/UD7-running_app_save_state.gif"><br><figcaption>Running App</figcaption></figure>
    <br>
    
    <br>
    <p>The app works as expected. But what if we turn over the mobile phone to landscape position</p>


    <figure><img src="./Data persistence_files/UD7-running_app_save_state_error.gif"><br><figcaption>Running App</figcaption></figure>
    <br>
    <br>
    <p>As we can see, the counter value is set to 0 again. This is because when we turn the mobile, the activity is created again, starting the counter at 0.</p>
    <p>Let's add a Log to check that in the <span class="inline-file">MainActitity</span></p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token operator">:</span>String<span class="token punctuation">)</span><span class="token punctuation">{</span>
    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> text <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>And remember create the <span class="negrita">TAG</span> </p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> TAG <span class="token operator">=</span><span class="token string">"SAVE_STATE_TAG"</span>

<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>Now every time we enter the onCreate we execute the log function</p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onCreate Method"</span><span class="token punctuation">)</span>
    <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>Launch the App and let's see</p>

    <figure><img src="./Data persistence_files/UD7-running_app_save_state_log.gif"><br><figcaption>onCreate is called two times</figcaption></figure>
    <br>
    <br>

    <h3>onSaveInstanceState and onRestorenIstanceState</h3>

    <p>
        <span class="r-word">onSaveInstanceState</span>  allows us to save data after the activity stops.
        <span class="r-word">onRestorenIstanceState</span>  allows us to retrieve previously stored data
    </p>
    <p>To see when each of these methods are executed we are going to override them and call our log function, in addition we will also include the 
        <span class="r-word">onResume</span>  function on the <span class="inline-file">MainActivity.kt</span></p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onResume"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token operator">:</span>Bundle<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onSaveInstanceState"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onRestoreInstanceState</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onRestoreInstanceState</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onRestoreInstanceState"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
<p>
    If we launch the application and later turn the mobile, the result of the log will be as follows.</p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token comment">//App is recently launched</span>
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> onCreate Method
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> We are onResume
<span class="token comment">//Here we rotate the mobile</span>
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> We are onSaveInstanceState
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> onCreate Method
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> We are onRestoreInstanceState
com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>savestate D<span class="token operator">/</span>SAVE_STATE_TAG<span class="token operator">:</span> We are onResume<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code>
</pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div></section>
<br><br>

<p class="sub-section">Saving and Restoring the State</p>

<p>Now, we are using the <span class="negrita">Bundle</span>  to save our data so we can retrieve it later.</p>

<p>We simply have to add our <span class="d-word">counter</span>  to the <span class="negrita">Bundle</span>  so that we can later retrieve it. 
    Remember to use the same Key to retrieve it, the best option is to create a constant.</p>

<section class="marco-t file-">
    <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
    </section>
<section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Log
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> TAG <span class="token operator">=</span><span class="token string">"SAVE_STATE_TAG"</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> COUNTER_KEY<span class="token operator">=</span><span class="token string">"COUNTER_KEY"</span>

<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> counter<span class="token operator">=</span><span class="token number">0</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> tvCounter<span class="token operator">:</span> TextView <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tvCounter<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> btnInc<span class="token operator">:</span> Button <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btnInc<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"onCreate Method"</span><span class="token punctuation">)</span>

        btnInc<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token function">increaseCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">increaseCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">++</span>

        <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tvCounter<span class="token punctuation">.</span>text<span class="token operator">=</span>counter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token operator">:</span>String<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> text <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onResume"</span><span class="token punctuation">)</span>
        <span class="token function">updateTvCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token operator">:</span>Bundle<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onSaveInstanceState"</span><span class="token punctuation">)</span>
        outState<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>COUNTER_KEY<span class="token punctuation">,</span>counter<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onRestoreInstanceState</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onRestoreInstanceState</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are onRestoreInstanceState"</span><span class="token punctuation">)</span>

        counter<span class="token operator">=</span>savedInstanceState<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>COUNTER_KEY<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
</section>


<p>Notice that we've moved the <span class="d-word">updateTvCounter()</span>  method from <span class="r-word">onCreate</span>  to <span class="r-word">onResume</span> </p>

<figure><img src="./Data persistence_files/UD7-running_app_save_state_ok.gif"><br><figcaption>Save State Working ok</figcaption></figure>
<br>

<section class="marco-t inf">
    <span class="icono info"> </span> <span class="negrita">EditText</span>  save its sate internally so you don't have to implement anything for them.
    <br><br>
    For more complex Apps, it is better to use ViewModel pattern.
    </section>
<section class="marco-b">
        
</section>
    

<p>You can see the complete project <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/CounterSaveState">here</a> </p>




    </section><!-- End section -->

    <!--*********************************************************File System***********************************************************-->
    <section class="apartado">
    <a name="sFileSystem"></a>
    <h2>File System</h2>

    <h3>Introduction</h3>
    
    
    <p>Android uses a file system which is imilar to disk-based file systems on other platforms. The system provides several options for you to save your app data:</p>
    <p>
    </p><ul>
        <li><span class="d-word"><span class="negrita">App-specific storage</span> </span>: Store files that are meant for your app's use only, either in dedicated directories within an 
            <span class="negrita"><span class="subrayado">internal storage</span></span> volume or different dedicated directories within <span class="negrita"><span class="subrayado">external storage</span></span>   . 
            <span class="subrayado">Use the directories within internal storage to save sensitive information that other apps shouldn't access.</span></li>
        <li><span class="d-word"><span class="negrita">Shared storage</span></span>: Store files that your app intends to share with other apps, including media, documents, and other files.</li>
        <li><span class="d-word"><span class="negrita">Preferences</span></span>: Store private, primitive data in key-value pairs.</li>
        <li><span class="d-word"><span class="negrita">Databases</span></span>: Store structured data in a private database using the Room persistence library.</li>
    </ul>
<p></p>    
<p>The characteristics of these options are summarized in the following table:</p>

    <figure><img src="./Data persistence_files/ud7-2021-11-24-11-58-36.png"><br><figcaption></figcaption></figure>
    <br>
    <br>

    <p>The solution you choose depends on your specific needs:</p>
    

<p><span class="negrita">How much space does your data require?</span> </p>

<p>Internal storage has limited space for app-specific data. Use other types of storage if you need to save a substantial amount of data.</p>
<br>
<p><span class="negrita">How reliable does data access need to be?</span> </p>

<p>If your app's basic functionality requires certain data, such as when your app is starting up, place the data within internal storage directory or a database. App-specific files that are stored in external storage aren't always accessible because some devices allow users to remove a physical device that corresponds to external storage.</p>
<br>
<p><span class="negrita">What kind of data do you need to store?</span> </p>


<p>If you have data that's only meaningful for your app, use app-specific storage. For shareable media content, use shared storage so that other apps can access the content. 
    For structured data, use either preferences (for key-value data) or a database (for data that contains more than 2 columns).</p>

<br>
<p><span class="negrita">Should the data be private to your app?</span> </p>

<p>When storing sensitive data—data that shouldn't be accessible from any other app—use internal storage, preferences, or a database. 
    Internal storage has the added benefit of the data being hidden from users.</p>


<h3>Access app-specific files</h3>

<p>In many cases, your app creates files that other apps don't need to access, or shouldn't access. The system provides the following locations for storing such app-specific files:</p>

<p>
    </p><ul>
        <li><span class="negrita">Internal storage directories</span>: These directories include both: a dedicated location for storing persistent files, 
            and another location for storing cache data. The system prevents other apps from accessing these locations, and on <span class="negrita">Android 10 (API level 29)</span> 
            and higher, these locations are encrypted. These characteristics make these locations a good place to store sensitive data that only your app itself can access.</li>
        <li>
            <span class="negrita">External storage directories</span> : These directories include both a dedicated location for storing persistent files, and another 
            location for storing cache data. Although it's possible for another app to access these directories if that app has the proper permissions, 
            the files stored in these directories are meant for use only by your app. If you specifically intend to create files that other apps should be able to access, 
            your app should store these files in the shared storage part of external storage instead.
        </li>
    </ul>
<p></p>
<p>When the user uninstalls your app, the files saved in app-specific storage are removed. Because of this behavior, you shouldn't use this storage to save anything that 
    the user expects to persist independently of your app. For example, if your app allows users to capture photos, the user would expect that they can access those 
    photos even after they uninstall your app. So you should instead use shared storage to save those types of files to the appropriate media collection.</p>


<h3>Access from internal storage</h3>
<p>For each app, the system provides directories within internal storage where an app can organize its files. One directory is designed for your app's persistent files, 
    and another contains your app's cached files. Your app doesn't require any system permissions to read and write to files in these directories.</p>

<p>Other apps cannot access files stored within internal storage. This makes internal storage a good place for app data that other apps shouldn't access.</p>
<p>Keep in mind, however, that these directories tend to be small. Before writing app-specific files to internal storage, your app should <span class="negrita">query the free space</span> 
    on the device.</p>
<br>
<p>This snippet allows us to know how much free space on the device</p>
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token comment">// App needs 10 MB within internal storage.</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> NUM_BYTES_NEEDED_FOR_MY_APP<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10L</span><span class="token punctuation">;</span>

<span class="token keyword keyword-val">val</span> storageManager<span class="token operator">=</span>applicationContext<span class="token punctuation">.</span>getSystemService<span class="token operator">&lt;</span>StorageManager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!!</span>
<span class="token keyword keyword-val">val</span> appSpecificInternalDirUuid<span class="token operator">:</span> UUID<span class="token operator">=</span>storageManager<span class="token punctuation">.</span><span class="token function">getUuidForPath</span><span class="token punctuation">(</span>filesDir<span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> availableBytes<span class="token operator">:</span> Long <span class="token operator">=</span>
        storageManager<span class="token punctuation">.</span><span class="token function">getAllocatableBytes</span><span class="token punctuation">(</span>appSpecificInternalDirUuid<span class="token punctuation">)</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>availableBytes <span class="token operator">&gt;=</span> NUM_BYTES_NEEDED_FOR_MY_APP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    storageManager<span class="token punctuation">.</span><span class="token function">allocateBytes</span><span class="token punctuation">(</span>
        appSpecificInternalDirUuid<span class="token punctuation">,</span> NUM_BYTES_NEEDED_FOR_MY_APP<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span> <span class="token comment">//We don't have enough space we ask for removing something</span>
    <span class="token keyword keyword-val">val</span> storageIntent<span class="token operator">=</span><span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        <span class="token comment">// To request that the user remove all app cache files instead, set</span>
        <span class="token comment">// "action" to ACTION_CLEAR_APP_CACHE.</span>
        action<span class="token operator">=</span>ACTION_MANAGE_STORAGE
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<h3>Access persistent files</h3>

<p>Your app's ordinary, persistent files reside in a directory that you can access using the <span class="r-word">filesDir</span>  property of a <span class="negrita">context</span> 
     object. The framework provides several methods to help you access and store files in this directory.</p>

<p>You can use the <span class="r-word">File</span>  API to access and store files.</p>
<p>To help maintain your app's performance, <span class="subrayado">don't open and close the same file multiple times</span> .</p>
<p>The following code snippet demonstrates how to use the <span class="r-word">File</span>  API:</p>
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> file<span class="token operator">=</span><span class="token function">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>filesDir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">Store a file using a stream</p>
<p>As an alternative to using the <span class="r-word">File</span>  API, you can call <span class="r-word">openFileOutput()</span>  to get a 
<span class="r-word">FileOutputStream</span>  that writes to a file within the <span class="r-word">filesDir</span>  directory.</p>

<p>The following code snippet shows how to write some text to a file:</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> filename<span class="token operator">=</span><span class="token string">"myfile"</span>
<span class="token keyword keyword-val">val</span> fileContents<span class="token operator">=</span><span class="token string">"Hello world!"</span>
context<span class="token punctuation">.</span><span class="token function">openFileOutput</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fileContents<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>We can see the file created in the <span class="negrita">Android Studio Device File Explorer</span> </p>

<figure><img src="./Data persistence_files/ud7_file_manager.gif"><br><figcaption>Android Studio Device File Explorer</figcaption></figure>
<br>


<section class="marco-t warn">
    <span class="icono warning"> </span> Caution: On devices that run Android 7.0 (API level 24) or higher, unless you pass the <span class="negrita">Context.MODE_PRIVATE</span> 
     file mode into <span class="negrita">openFileOutput()</span> , a <span class="subrayado">SecurityException will be thrown</span> .
    </section>
<section class="marco-b">
        
</section>

<section class="marco-t inf">
    <span class="icono info"> </span> To allow other apps to access files stored in this directory within internal storage, use a FileProvider 
    with the <span class="negrita">FLAG_GRANT_READ_URI_PERMISSION</span>  attribute.
    </section>
<section class="marco-b">
        
</section>
    
<p class="sub-section">Access a file using a stream</p>
<p>To read a file as a stream, use <span class="r-word">openFileInput()</span> :</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">context<span class="token punctuation">.</span><span class="token function">openFileInput</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bufferedReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useLines</span> <span class="token punctuation">{</span> lines <span class="token operator">-&gt;</span>
    lines<span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> some<span class="token punctuation">,</span> text <span class="token operator">-&gt;</span>
        <span class="token string">"<span class="token interpolation variable">$some</span>\n<span class="token interpolation variable">$text</span>"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">View list of files</p>
<p>You can get an array containing the names of all files within the <span class="r-word">filesDir</span>  directory by calling <span class="r-word">fileList()</span>, 
    as shown in the following code snippet:</p>
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-var">var</span> files<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;=</span>context<span class="token punctuation">.</span><span class="token function">fileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">Create nested directories</p>
<p>You can also create nested directories, or open an inner directory, by calling <span class="r-word">getDir()</span>:
</p><section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">context<span class="token punctuation">.</span><span class="token function">getDir</span><span class="token punctuation">(</span>dirName<span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>
<section class="marco-t inf">
    <span class="icono info"> </span> Note: filesDir is always an ancestor directory of this new directory.
    </section>
<section class="marco-b">
        
</section>



<p class="sub-section">Create cache files</p>
<p>If you need to store sensitive data only temporarily, you should use the app's designated cache directory within internal storage to save the data. 
    As is the case for all app-specific storage, the files stored in this directory are removed when the user uninstalls your app, although the files in this directory 
    might be removed sooner.</p>

<p>To create a cached file, call <span class="r-word">File.createTempFile()</span> :</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">File<span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>cacheDir<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

Your app accesses a file in this directory using the <span class="r-word">cacheDir</span>  property of a context object and the <span class="r-word">File</span>  API:
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> cacheFile<span class="token operator">=</span><span class="token function">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>cacheDir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">Remove cache files</p>

<p>Even though Android sometimes deletes cache files on its own, you shouldn't rely on the system to clean up these files for you. 
    You should always maintain your app's cache files within internal storage.</p>

<p>To remove a file from the cache directory within internal storage, use one of the following methods:</p>


<p>The <span class="r-word">delete()</span>  method on a <span class="r-word">File</span>  object that represents the file:</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">cacheFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p>The <span class="r-word">deleteFile()</span> method of the app's context, passing in the name of the file:</p>
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">context<span class="token punctuation">.</span><span class="token function">deleteFile</span><span class="token punctuation">(</span>cacheFileName<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>


<h3>Access from external storage</h3>
<p>If internal storage doesn't provide enough space to store app-specific files, consider using external storage instead. 
    The system provides directories within external storage where an app can organize files that provide value to the user only within your app. 
    One directory is designed for your app's persistent files, and another contains your app's cached files</p>

<p>On <span class="subrayado">Android 4.4 (API level 19) or higher</span>, your app doesn't need to request any storage-related permissions to access app-specific 
    directories within external storage. The files stored in these directories <span class="negrita">are removed when your app is uninstalled</span>.</p>

<section class="marco-t warn">
    <span class="icono warning"> </span> <span class="negrita">Caution</span> : The files in these directories aren't guaranteed to be accessible, such as when a removable 
    SD card is taken out of the device. If your app's functionality depends on these files, you should instead store the files within internal storage.
    </section>
<section class="marco-b">
        
</section>


<p>On devices that run <span class="subrayado">Android 9 (API level 28) or lower</span> , your app can access the app-specific files that belong to other apps, 
    provided that your app has the appropriate storage permissions. To give users more control over their files and to limit file clutter, 
    apps that target <span class="subrayado">Android 10 (API level 29) and higher</span>  are given scoped access into external storage, or scoped storage, by default. 
    When scoped storage is enabled, apps cannot access the app-specific directories that belong to other apps.</p>


<p class="sub-section">Verify that storage is available</p>

<p>Because external storage resides on a physical volume that the <span class="subrayado">user might be able to remove</span>, verify that the volume is accessible before trying
     to read app-specific data from, or write app-specific data to, <span class="negrita">external storage</span> .</p>

<p>You can query the volume's state by calling <span class="negrita">Environment.getExternalStorageState()</span> . If the returned state is <span class="r-word">MEDIA_MOUNTED</span>, 
    then you can read and write app-specific files within external storage. If it's <span class="r-word">MEDIA_MOUNTED_READ_ONLY</span> , you can only read these files.</p>

<p>For example, the following methods are useful to determine the storage availability:</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token comment">// Checks if a volume containing external storage is available</span>
<span class="token comment">// for read and write.</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">isExternalStorageWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> Environment<span class="token punctuation">.</span><span class="token function">getExternalStorageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Environment<span class="token punctuation">.</span>MEDIA_MOUNTED
<span class="token punctuation">}</span>

<span class="token comment">// Checks if a volume containing external storage is available to at least read.</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">isExternalStorageReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
     <span class="token keyword keyword-return">return</span> Environment<span class="token punctuation">.</span><span class="token function">getExternalStorageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-in">in</span>
        <span class="token function">setOf</span><span class="token punctuation">(</span>Environment<span class="token punctuation">.</span>MEDIA_MOUNTED<span class="token punctuation">,</span> Environment<span class="token punctuation">.</span>MEDIA_MOUNTED_READ_ONLY<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p class="sub-section">Select a physical storage location</p>


<p>Sometimes, a device that allocates a partition of its internal memory as external storage also provides an SD card slot. This means that the device has multiple physical volumes
     that could contain external storage, so you need to select which one to use for your app-specific storage.</p>

<p>To access the different locations, call <span class="negrita">ContextCompat.getExternalFilesDirs()</span> . As shown in the code snippet, the first element 
    in the returned array is considered the primary external storage volume. Use this volume unless it's full or unavailable.</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> externalStorageVolumes<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword keyword-out">out</span> File<span class="token operator">&gt;</span> <span class="token operator">=</span>
        ContextCompat<span class="token punctuation">.</span><span class="token function">getExternalFilesDirs</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> primaryExternalStorage<span class="token operator">=</span>externalStorageVolumes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>if we print the path, it would be</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token function">println</span><span class="token punctuation">(</span>primaryExternalStorage<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token operator">/</span>storage<span class="token operator">/</span>emulated<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span>Android<span class="token operator">/</span><span class="token keyword keyword-data">data</span><span class="token operator">/</span>com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>filesexample<span class="token operator">/</span>files<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>If our device has a memory card and also HD, <span class="negrita">externalStorageVolumes[1]</span> probably be the SD card and its path woul be something like this</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> secondaryExternalStorage<span class="token operator">=</span>externalStorageVolumes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">//be careful because the card may have been removed and throw a NullPointerException</span>
<span class="token function">println</span><span class="token punctuation">(</span>secondaryExternalStorage<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>

<span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token comment">//OUTPUT</span>
<span class="token operator">/</span>storage<span class="token operator">/</span>11EA<span class="token operator">-</span><span class="token number">1213</span><span class="token operator">/</span>Android<span class="token operator">/</span><span class="token keyword keyword-data">data</span><span class="token operator">/</span>com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>filesexample<span class="token operator">/</span>files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p class="sub-section">Access persistent files</p>

<p>To access app-specific files from external storage, call <span class="r-word">getExternalFilesDir()</span>.</p>

<p>To help maintain your app's performance, don't open and close the same file multiple times.</p>

<p>The following code snippet demonstrates how to call <span class="negrita">getExternalFilesDir()</span>:</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> appSpecificExternalDir<span class="token operator">=</span><span class="token function">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>

<span class="token comment">//PATH</span>
<span class="token operator">/</span>storage<span class="token operator">/</span>emulated<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span>Android<span class="token operator">/</span><span class="token keyword keyword-data">data</span><span class="token operator">/</span>com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>filesexample<span class="token operator">/</span>files<span class="token operator">/</span>my_file
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<section class="marco-t inf">
    <span class="icono info"> </span> On Android 11 (API level 30) and higher, apps cannot create their own app-specific directory on external storage.
    </section>
<section class="marco-b">
        
</section>
    
<p class="sub-section">Create cache files</p>
<p>To add an app-specific file to the cache within external storage, get a reference to the <span class="r-word">externalCacheDir</span>:</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> externalCacheFile<span class="token operator">=</span><span class="token function">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>externalCacheDir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">Remove cache files</p>

<p>To remove a file from the external cache directory, use the <span class="r-word">delete()</span>  method on a <span class="r-word">File</span>  object that represents the file</p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">externalCacheFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p class="sub-section">Media content</p>
<p>If your app works with media files that provide value to the user only within your app, it's best to store them in app-specific directories within external storage, 
    as demonstrated in the following code snippet:</p>

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">getAppSpecificAlbumStorageDir</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> albumName<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> File<span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the pictures directory that's inside the app-specific directory on</span>
    <span class="token comment">// external storage.</span>
    <span class="token keyword keyword-val">val</span> file<span class="token operator">=</span><span class="token function">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span>
            Environment<span class="token punctuation">.</span>DIRECTORY_PICTURES<span class="token punctuation">)</span><span class="token punctuation">,</span> albumName<span class="token punctuation">)</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>LOG_TAG<span class="token punctuation">,</span> <span class="token string">"Directory not created"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> file
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

 <p>It's important that you use directory names provided by API constants like <span class="r-word">DIRECTORY_PICTURES</span>. These directory names ensure that the files 
    are treated properly by the system. If none of the pre-defined sub-directory names suit your files, you can instead pass <span class="negrita">null</span> 
     into <span class="negrita">getExternalFilesDir()</span> . This returns the root app-specific directory within external storage.</p>
    



    <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/DirectoriesFiles">Example of usage with directories and files on Github</a> 


    </section><!-- End section -->


    <!--*********************************************************Shared Preferences***********************************************************-->
    <section class="apartado">
    <a name="sShared"></a>
    <h2>Shared Preferences</h2>
    <p>Shared are intended to store small amounts of information through <span class="negrita">key-value</span>. 
        It must be uncommitted information since Android will generate an XML file where it will store all this information <span class="negrita">unencrypted</span>. 
    These files can be shared or private.</p>

    <p>In this project we are going to create a very simple application in which if there is no name saved, it will ask us to put it, 
        if on the contrary we already have one, it will appear on the screen together with a delete button. Another important part is that we will 
        make a <span class="negrita">design pattern</span> , the <span class="d-word">Singleton</span> .</p>
    
    <p>The first thing we will do is create a <span class="negrita">new project</span>  and we will make a very simple layout of the layout</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">activity_main.xml</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tvName<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/etName<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>hint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Write your name<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/btnDeleteValue<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Delete<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/btnSaveValue<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Save<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    
    <p>You will see that there are components that are overlapping on each other, this is because in this way we're going to show the possible cases that a view can have.</p>
        
    <p>The next thing we will do is create a class where we will define everything necessary to work with shared, we will call it <span class="d-word">Prefs</span>.
        This class will receive a <span class="negrita">context</span> , in this case that of the application, to be able to instantiate it only once when starting
        the application and have a <span class="negrita">pref object</span> .</p>

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">Prefs.kt</span>
        </section>
    <section class="marco-b">
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-class">class</span> <span class="token function">Prefs</span> <span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> prefs<span class="token operator">:</span> SharedPreferences <span class="token operator">=</span>context<span class="token punctuation">.</span><span class="token function">getSharedPreferences</span> <span class="token punctuation">(</span>PREFS_NAME<span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span>
    <span class="token keyword keyword-var">var</span> name<span class="token operator">:</span> String
        <span class="token keyword keyword-get">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span>prefs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>SHARED_NAME<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">""</span>
        <span class="token keyword keyword-set">set</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">=</span>prefs<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putString</span> <span class="token punctuation">(</span>SHARED_NAME<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> PREFS_NAME<span class="token operator">=</span><span class="token string">"com.catata.sharedpreferencesexample"</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> SHARED_NAME<span class="token operator">=</span><span class="token string">"shared_name"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>

    <p>The first thing we have done has been to define two constants, <span class="d-word">PREFS_NAME</span>  and <span class="d-word">SHARED_NAME</span>, 
        the first will be the key of the <span class="negrita">pref object</span>  that we will create later and the second the key of the name that we will store. 
        Remember that shared preferences are stored with key-value, which means that to request the value of "<span class="negrita">yam</span>" we need to request it through the SHARED_NAME key.</p>
    
    <p>Also note that we have defined a <span class="d-word">yam</span>  variable that will be where we store the name as I said before, 
        but that we have <span class="subrayado">overridden the get and set method</span>, so when we ask for the value of name, it will access the prefs object 
        and request that value corresponding to the <span class="d-word">SHARED_NAME</span>  key. The same with the set, that through <span class="d-word">prefs.edit(). 
        PutString (SHARED_NAME, value).apply()</span> store the value we tell it. Obviously if it were another type of variable, for example an <span class="negrita">Int</span>, 
        we would change the <span class="negrita">putString()</span>  for a putInt() and so on with each type of variable.</p>
    
    <p>Now we are going to create a somewhat different class. This class will extend <span class="r-word">Application ()</span> and that means that it will 
        <span class="negrita">be the first thing to run</span> when the application is opened.</p>

        <p>Remember that to extend this class in Kotlin it is very simple, we simply have to create a class as usual and after the name after a colon, 
            we will put the class in question.</p>
        

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">SharedApp.kt</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-class">class</span> SharedApp<span class="token operator">:</span> <span class="token function">Application</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> prefs<span class="token operator">:</span> Prefs
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        prefs<span class="token operator">=</span><span class="token function">Prefs</span> <span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    
    <p>Although the class is quite small, we are going to comment on some things. To begin, we have declared a <span class="negrita">companion object</span>  that will be the 
        object of our <span class="d-word">Prefs</span>  class that we will use throughout the project, so for you to understand the companion object is a way 
        to have an object available throughout the project (a static object for those who know java). And in front of it there is a <span class="r-word">lateinit</span> 
         that means that it will be instantiated later, in this example in the <span class="r-word">onCreate()</span>  method of this class.</p>
    
    <p>Remember that for this class to be launched when opening the app we must go to <span class="inline-file">AndroidManifest.xml</span> and add 
        </p><section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml">android: name=".SharedApp"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br> inside the&lt;Application&gt; open tag<p></p>

    <p>Now we will go to our <span class="d-word">MainActivity</span>  to develop some logic.</p>
        
    <p>The idea is to create <span class="subrayado">two methods</span> , one will show a view for guests and the other the view of the profile, the difference between them will be that if you are 
        invited it will show you an EditText and a save button and on the contrary if there is already a name saved in data persistence as it will greet user and will 
        have a button to delete that field from memory.</p>
    
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">showProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
    binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>text<span class="token operator">=</span><span class="token string">"Hello <span class="token interpolation"><span class="token delimiter variable">${</span>SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span>"</span>
    binding<span class="token punctuation">.</span>btnDeleteValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
    binding<span class="token punctuation">.</span>etName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
    binding<span class="token punctuation">.</span>btnSaveValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
<span class="token punctuation">}</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">showGuest</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
    binding<span class="token punctuation">.</span>btnDeleteValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
    binding<span class="token punctuation">.</span>etName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
    binding<span class="token punctuation">.</span>btnSaveValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>

    <p>As you already know, a component can be in three visibility states:</p>
    <ul>
        <li><span class="negrita">Visible</span>: The component is seen on the screen, this option is activated by default.</li>
        <li><span class="negrita">Invisible</span>: The component is not visible but it is still on the screen, so you can continue working with it, 
            for example putting something to the right of an invisible component.</li>
        <li><span class="negrita">Gone</span> : The component is NOT on the screen so there is no interaction possible.</li>
    </ul>

    <p>Notice that the <span class="d-word">showProfile</span> method assigns a value to <span class="d-word">tvName</span>, which means that it is accessing
         the <span class="negrita">shared preferences</span>. To do this we simply call the <span class="d-word">SharedApp</span>  class (the one that contains 
         the companion object), the object we are talking about and the name attribute that, as we saw before, we have modified so that when we do a get 
         (remove the information it stores) it asks for our shared preference the value of <span class="d-word">SHARED_NAME</span> .</p>
    
    <p>Now we need a method that checks if there is information in name and thus check if the user has saved his name.</p>
    
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">configView</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isSavedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">showProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-else">else</span> <span class="token function">showGuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-fun">fun</span> <span class="token function">isSavedName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> myName<span class="token operator">=</span>SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name
    <span class="token keyword keyword-return">return</span> myName<span class="token operator">!=</span>EMPTY_VALUE
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section>

        <p>The whole class would look like this.</p>
        <section class="marco-t file-">
            <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
            </section>
        <section class="marco-b">
                       
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>cartatar<span class="token punctuation">.</span>sharedpreferencesexample<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span>ActivityMainBinding

<span class="token keyword keyword-class">class</span> MainActivity<span class="token operator">:</span> <span class="token function">AppCompatActivity</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> binding<span class="token operator">:</span> ActivityMainBinding

    <span class="token keyword keyword-val">val</span> EMPTY_VALUE<span class="token operator">=</span><span class="token string">""</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span> <span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span> <span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span> <span class="token punctuation">(</span>ActivityMainBinding<span class="token punctuation">.</span><span class="token function">inflate</span> <span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>binding<span class="token operator">=</span>it<span class="token punctuation">}</span> <span class="token punctuation">.</span>root<span class="token punctuation">)</span>

        binding<span class="token punctuation">.</span>btnSaveValue<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name<span class="token operator">=</span>binding<span class="token punctuation">.</span>etName<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">configView</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        binding<span class="token punctuation">.</span>btnDeleteValue<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name<span class="token operator">=</span>EMPTY_VALUE
            <span class="token function">configView</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token function">configView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token keyword keyword-fun">fun</span> <span class="token function">showProfile</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
        binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>text<span class="token operator">=</span><span class="token string">"Hello <span class="token interpolation"><span class="token delimiter variable">${</span>SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span>"</span>
        binding<span class="token punctuation">.</span>btnDeleteValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
        binding<span class="token punctuation">.</span>etName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
        binding<span class="token punctuation">.</span>btnSaveValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">showGuest</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        binding<span class="token punctuation">.</span>tvName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
        binding<span class="token punctuation">.</span>btnDeleteValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>INVISIBLE
        binding<span class="token punctuation">.</span>etName<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
        binding<span class="token punctuation">.</span>btnSaveValue<span class="token punctuation">.</span>visibility<span class="token operator">=</span>View<span class="token punctuation">.</span>VISIBLE
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">configView</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isSavedName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">showProfile</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-else">else</span> <span class="token function">showGuest</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">isSavedName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> myName<span class="token operator">=</span>SharedApp<span class="token punctuation">.</span>prefs<span class="token punctuation">.</span>name
        <span class="token keyword keyword-return">return</span> myName<span class="token operator">!=</span>EMPTY_VALUE
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section>
</section>
<section class="marco-t warn">
    <span class="icono warning"> </span> Remember to enable view binding
    </section>
<section class="marco-b">
        
</section>

    
<figure><img src="./Data persistence_files/UD7-shared_example.gif"><br><figcaption>App running</figcaption></figure>
<br>


<p>Here is where the shared preference is saved in xml file. Note the name of the file (<span class="negrita">com.catata.sharedpreferencesexample.xml</span>)
     and the name of the SharedPreference (<span class="negrita">shared_name</span>)</p>

<figure><img src="./Data persistence_files/ud7_shared_preferences_path.gif"><br><figcaption>Shared Preferences</figcaption></figure>
<br>



<p>Here's a <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/SharedPreferences"> link </a> to Github with another example of using <span class="negrita">Shared Preferences</span>.
    Notice that we have two methods to access the SharedPreferences. On the one hand we have <span class="r-word">getPreferences</span> , which obtains the normal and global 
    preferences and on the other hand we have, <span class="r-word">getSharedPreferences</span>  method to which we give a name of the preferences file, in case we want to have several files and separate the information</p>


<br><br>
<p>Here is another <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/DirectoriesFilesSharedDao"> link </a> to Github with an example 
    where we implement the <span class="negrita">DAO pattern</span> and also with <span class="negrita">ViewModel pattern</span> to access the saved data by means of a file through SharedPreferences.</p>


    <h3>Settings Screen</h3>

    <p>In this section we will see how to implement a settings screen using SharedPreferences</p>

    <p>To start we are going to create a project from <span class="negrita">empty activity</span> template and name the App as <span class="d-word">SharedSettings</span> </p>

    <p>The first thing we will do is add the dependencies, remember to also enable the <span class="negrita">viewBinding</span> .</p>
    
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">def nav_version<span class="token operator">=</span><span class="token string">"2.5.3"</span>
<span class="token function">implementation</span> <span class="token punctuation">(</span><span class="token string">"androidx.navigation:navigation-fragment-ktx:<span class="token interpolation variable">$nav_version</span>"</span><span class="token punctuation">)</span>
<span class="token function">implementation</span> <span class="token punctuation">(</span><span class="token string">"androidx.navigation:navigation-ui-ktx:<span class="token interpolation variable">$nav_version</span>"</span><span class="token punctuation">)</span>

<span class="token comment">// Preferences</span>
def preference_version<span class="token operator">=</span><span class="token string">"1.2.0"</span>
<span class="token function">implementation</span> <span class="token punctuation">(</span><span class="token string">"androidx.preference:preference-ktx:<span class="token interpolation variable">$preference_version</span>"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>We are going to create a menu with a couple of options, one of them will not do anything, it is simply as an example to show the usefulness of the <span class="r-word">orderInCategory</span> property.</p>
    
    <p>So, we create the menu <span class="inline-file">my_menu.xml</span> inside the <span class="inline-folder">res/menu</span> directory</p>

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">my_menu.xml</span>
        </section>
    <section class="marco-b">
         <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>. MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/action_settings<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/action_settings<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orderInCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>showAsAction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>never<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/action<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/action<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orderInCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>showAsAction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>never<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
         </section><br><br>   
    </section>
    
    <p>Now we are going to create the layout of the <span class="d-word">MainActivity</span> , in this case it will only contain a fragment container.</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">activity_main.xml</span>
        </section>
    <section class="marco-b">
         <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>. MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/container_main<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.cartatar.sharedsettings.MainFragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
         </section><br><br>   
    </section>
    
    <p>As you can see, it is going to contain the <span class="d-word">MainFragment</span>  fragment, so you create a new blank fragment with this name.  <br>
        In the layout, <span class="inline-file">fragment_main.xml</span> we are going to add a TextView </p>
    

    <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainFragment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tvInfo<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Shared Preferences\nin Settings Screen<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25sp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>Now it is the turn of the MainActivity, we are going to link the menu created previously so that it is loaded in the activity, and we are also going to add a method 
        so that it responds to the actions of the menu created.
    <br>For this we are going to override two methods in the <span class="inline-file">MainActivity.kt</span>.</p>
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateOptionsMenu</span> <span class="token punctuation">(</span>menu<span class="token operator">:</span> Menu<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
    menuInflater<span class="token punctuation">.</span><span class="token function">inflate</span> <span class="token punctuation">(</span>R<span class="token punctuation">.</span>menu<span class="token punctuation">.</span>my_menu<span class="token punctuation">,</span> menu<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token operator">:</span> MenuItem<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

    <span class="token keyword keyword-when">when</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_settings <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">startActivity</span> <span class="token punctuation">(</span><span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> SettingsActivity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>The first, <span class="r-word">onCreateOptionsMenu</span> , is the one that loads or inflates the menu and the second is the one that is executed 
        when we select an item from our menu. <br>As you can see, we give you which item has been selected and based on its ID we do one thing or another, 
        in our case we only respond to the item whose id is action_settings and what we do is open the activity that contains the settings screen.</p>

    <p>So MainActivity would look like this</p>
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-class">class</span> MainActivity<span class="token operator">:</span><span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> binding<span class="token operator">:</span> ActivityMainBinding
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span> <span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span>Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span> <span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span> <span class="token punctuation">(</span>ActivityMainBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span><span class="token punctuation">{</span>binding<span class="token operator">=</span>it<span class="token punctuation">}</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>


    <span class="token punctuation">}</span>


    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateOptionsMenu</span> <span class="token punctuation">(</span>menu<span class="token operator">:</span> Menu<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        menuInflater<span class="token punctuation">.</span><span class="token function">inflate</span> <span class="token punctuation">(</span>R<span class="token punctuation">.</span>menu<span class="token punctuation">.</span>my_menu<span class="token punctuation">,</span> menu<span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>item<span class="token operator">:</span> MenuItem<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword keyword-when">when</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_settings <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">startActivity</span> <span class="token punctuation">(</span><span class="token function">Intent</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> SettingsActivity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onOptionsItemSelected</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>

    <p>Notice we haven't created the <span class="negrita">SettingsActivity</span> yet</p>
    
    
    <p>Now what we will do is add in <span class="d-word">MainFragment</span>  a listener of the <span class="r-word">SharedPreferences</span> 
         so that it reacts when they are modified, in our case the only thing we will do is show it in a TextView. So <span class="inline-file">MainFragment</span> would look like this</p>
    
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-class">class</span> MainFragment<span class="token operator">:</span><span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> binding<span class="token operator">:</span> FragmentMainBinding

    <span class="token comment">//listener is listening for every change on the SharedPreferences</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> listener<span class="token operator">:</span> SharedPreferences<span class="token punctuation">.</span>OnSharedPreferenceChangeListener

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateView</span> <span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span> container<span class="token operator">:</span> ViewGroup <span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle <span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token comment">// Inflate the layout for this fragment</span>
        <span class="token keyword keyword-return">return</span> FragmentMainBinding<span class="token punctuation">.</span><span class="token function">inflate</span> <span class="token punctuation">(</span>
            inflater<span class="token punctuation">,</span>
            container<span class="token punctuation">,</span>
            <span class="token boolean">false</span>
        <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>binding<span class="token operator">=</span>it<span class="token punctuation">}</span> <span class="token punctuation">.</span>root
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onViewCreated</span> <span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">,</span> savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onViewCreated</span> <span class="token punctuation">(</span>view<span class="token punctuation">,</span> savedInstanceState<span class="token punctuation">)</span>

        <span class="token comment">/* Obtaining SharedPreferences */</span>
        <span class="token keyword keyword-val">val</span> sharedPreferences<span class="token operator">:</span> SharedPreferences <span class="token operator">=</span>
            PreferenceManager<span class="token punctuation">.</span><span class="token function">getDefaultSharedPreferences</span><span class="token punctuation">(</span><span class="token function">requireContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/* Activity context */</span><span class="token punctuation">)</span>

        <span class="token comment">//Making the callback of the listener</span>
        listener<span class="token operator">=</span>SharedPreferences<span class="token punctuation">.</span><span class="token function">OnSharedPreferenceChangeListener</span> <span class="token punctuation">{</span>prefs<span class="token punctuation">,</span> key <span class="token operator">-&gt;</span>
            <span class="token comment">//Array with all the preferences</span>
            <span class="token keyword keyword-val">val</span> preferences<span class="token operator">=</span>prefs<span class="token punctuation">.</span>all
            
            <span class="token comment">//The key contains the name of the changed preference</span>
            <span class="token keyword keyword-val">val</span> s<span class="token operator">=</span>preferences <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token function">toString</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//Write the changed shared into TextView</span>
            binding<span class="token punctuation">.</span>tvInfo<span class="token punctuation">.</span>text<span class="token operator">=</span>s
        <span class="token punctuation">}</span>

        <span class="token comment">//we register the listener</span>
        sharedPreferences<span class="token punctuation">.</span><span class="token function">registerOnSharedPreferenceChangeListener</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section>

    <p class="sub-section">Creating the settings screen.</p>
    <p>First we create <span class="d-word">SettingsActivity</span>  from an empty activity template</p>
    <p>The <span class="inline-file">activity_settings.xml</span> layout will simply have a fragment container.</p>

    <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.SettingsActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/container_settings<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.cartatar.sharedsettings.SettingsFragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>As you can see, the container is waiting for <span class="d-word">SettingsFragment</span> , but in this case it is a special fragment since it extends
         <span class="r-word">PreferenceFragmentCompat</span> . This class contains the <span class="r-word">onCreatePreferences</span>  method, which is the one that will 
         load the xml with the definition of the settings. SettingsFragment won't have layout file</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">SettingsFragment.kt</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-class">class</span> SettingsFragment<span class="token operator">:</span><span class="token function">PreferenceFragmentCompat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreatePreferences</span> <span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle <span class="token operator">?</span><span class="token punctuation">,</span> rootKey<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setPreferencesFromResource</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>my_settings<span class="token punctuation">,</span> rootKey<span class="token punctuation">)</span>
        preferenceFragmentCompat<span class="token operator">=</span><span class="token keyword keyword-this">this</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-var">var</span> preferenceFragmentCompat<span class="token operator">:</span>PreferenceFragmentCompat<span class="token operator">?</span><span class="token operator">=</span><span class="token keyword keyword-null">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    
    <p>We create a companion object in case we want to access any of its preferences, we would do it with this code:</p>
    

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> preference<span class="token operator">=</span>preferenceManager<span class="token punctuation">.</span>preferenceScreen<span class="token punctuation">.</span>findPreference<span class="token operator">&lt;</span>Preference<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"preference_key"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>
    <p>In addition, the <span class="r-word">setPreferencesFromResource</span>  method passes as a parameter the <span class="inline-file">my_settings.xml</span> 
        file that is inside the <span class="inline-folder">res/xml</span> directory. Well, let's make it.</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">res/xml/my_settings.xml</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.preference.PreferenceScreen</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PreferenceCategory</span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>category1<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First Category<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SwitchPreferenceCompat</span>
            <span class="token attr-name"><span class="token namespace">app:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Notifications<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Activate Notifications<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Preference</span>
            <span class="token attr-name"><span class="token namespace">app:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>feedback<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Send feedback<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>summary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Report technical issues or suggest new features<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PreferenceCategory</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PreferenceCategory</span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Category2<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Second Category<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>


       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ListPreference</span>
            <span class="token attr-name"><span class="token namespace">android:</span>defaultValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>entries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@array/country<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>entryValues</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@array/cod_country<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list_preference_1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>List preference<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditTextPreference</span>
            <span class="token attr-name"><span class="token namespace">android:</span>defaultValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Default value<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit_text_preference_1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>selectAllOnFocus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Edit text preference<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Preference</span>
            <span class="token attr-name"><span class="token namespace">app:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>activity<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Go activity 2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent</span>
                <span class="token attr-name"><span class="token namespace">android:</span>targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.cartatar.sharedsettings<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>targetClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.cartatar.sharedsettings.MainActivity2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Preference</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PreferenceCategory</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.preference.PreferenceScreen</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    
    <br><br>
    <p>
        As you can see we have put a small selection of elements that you can implement. For example, a switch, a list, an EditText or even a preference so that 
        clicking on it will take us to another activity.
    </p>
    <p>Let's highlight, for example, ListPreference, we see that it has some entries that is an array, this is the texts that will be displayed and an entriesValues, 
        another array with the real values ​​that will have the preference whose key is <span class="negrita">list_preference_1</span> </p>

    <p>As it refers to some arrays, let's create them inside the <span class="inline-folder">res / values</span> ​​folder, inside a file called, for example, <span class="inline-file">cod_countries.xml</span>. And whose content will be:</p>
    
    <section><div class="code-toolbar"><pre class="language-xml line-numbers" tabindex="0"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>Spain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>France<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>Germany<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cod_country<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>SPA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>FRA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>GER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    
<a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/SettingScreen">Here</a>  you can see the whole code of the example.
 <br><br>

<div class="tarea">
    <span class="negrita">Activity</span>. <br>
    Make an App with just one Activity and one menu option, this option launches the settings screen that contains a ListPreference with 3 or 4 colors for the background of the application, another ListPreference with 3 or 4 colors for the color 
    of the text and an EditTextPreference to change the title of the application
</div>

<br><br>
<div><a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/ChangeColorsSettings">Here</a>  you have a possible solution. 
    Please, try to do it by yourself before</div>


    </section><!-- End section -->

    <!--*********************************************************Room***********************************************************-->
    <section class="apartado">
    <a name="sRoom"></a>
    <h2>Room</h2>
    

    <p>Once we have seen some local persistence methods, we are going to see the handling of databases, in this case with
    
    <a class="enlace" target="_blank" href="https://developer.android.com/training/data-storage/sqlite">SQLite</a>. 
    But as noted on the SQLite lite page, on this one, they highly recommend using the 
    <a class="enlace" target="_blank" href="https://developer.android.com/training/data-storage/room"> Room </a> persistence library.
    
</p>

    <section class="marco-t warn">
        <span class="icono warning"> </span> <span class="negrita">Caution</span>: Although these APIs are powerful, they are characterized by being quite specific and their use requires
         a lot of time and effort.
        <li>There is no compile-time verification of raw SQL queries. As your data graph changes, you must manually update the affected SQL queries.
        This process can be time consuming and cause errors.</li>
        <li>You must use a lot of standard code to convert between SQL queries and data objects.</li>
        For these reasons, <span class="negrita">we highly recommend</span>  using the <span class="r-word">Room Persistence Library</span>  as an abstraction layer to access information from your app's SQLite databases.
        </section>
    <section class="marco-b">
            
    </section>
    

    <p>To learn how to use <span class="r-word">Room</span>  we will create an application to <span class="subrayado">manage our tasks</span>. 
        We will add a task in the corresponding field, we will have a <span class="cursiva">CheckBox</span>  to see if the task is done or not, 
        we can change its status by checking and unchecking the <span class="cursiva">Check box</span>  and finally if we click on a task it will be eliminated.</p>
    

    <p>It is already beginning to be an App of a certain level. For the realization of this App we will need applications knowledge about:</p>
    <ul>
        <li><span class="negrita">RecyclerView</span> : The tasks will be shown as elements of the list.</li>
        <li><span class="negrita">Room</span> : Database creation and access.</li>
        <li><span class="negrita">ViewModel</span> : To separate the business logic from the views.</li>
        <li><span class="negrita">DAO pattern</span> : To make persistence mode independent of logic.</li>
        <li><span class="negrita">Corroutines</span> : To launch the DAO functions in a different thread from the main one.</li>

    </ul>
    <br><br>

    <p>The application will look something like this:</p>
    

    <figure><img src="./Data persistence_files/UD7-Room_running_app.gif"><figcaption>Running app</figcaption></figure>
    <br>
    
    <p>The first thing we will do is create a new application from the <span class="negrita">Empty Activity</span>  template.</p>
    

    <h3>Adding dependencies</h3>

    <p>Once loaded in Android Studio we will add the necessary dependencies:</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">Gradle Module App</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token comment">//RecycleView</span>
def recycler_version<span class="token operator">=</span><span class="token string">"1.2.1"</span>
implementation <span class="token string">"androidx.recyclerview:recyclerview:<span class="token interpolation variable">$recycler_version</span>"</span>

<span class="token comment">//Room</span>
def room_version<span class="token operator">=</span><span class="token string">"2.4.3"</span>
implementation <span class="token string">"androidx.room:room-runtime:<span class="token interpolation variable">$room_version</span>"</span>
kapt <span class="token string">"androidx.room:room-compiler:<span class="token interpolation variable">$room_version</span>"</span>
implementation <span class="token string">"androidx.room:room-ktx:<span class="token interpolation variable">$room_version</span>"</span>

<span class="token comment">// Lifecycle libraries</span>
def lifecycle_version<span class="token operator">=</span><span class="token string">"2.5.1"</span>
implementation <span class="token string">"androidx.lifecycle:lifecycle-viewmodel-ktx:<span class="token interpolation variable">$lifecycle_version</span>"</span>
implementation <span class="token string">"androidx.lifecycle:lifecycle-livedata-ktx:<span class="token interpolation variable">$lifecycle_version</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    

    <p>We also add the activation of <span class="negrita">viewBinding</span> in the same file</p>
    

    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">buildFeatures<span class="token punctuation">{</span>
        viewBinding <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>
    
    <p>As we can see we are going to make use of the Kapt method, in order to use it we will have to apply the plugin. 
        To do this in the same <span class="inline-file">Gradle Module App</span> file, in the plugins section we add it.</p>
    
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">plugins <span class="token punctuation">{</span>
    id <span class="token string">'com.android.application'</span>
    id <span class="token string">'kotlin-android'</span>
    id <span class="token string">'kotlin-kapt'</span> 
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>

    <p>Finally, as we have used variables for the versions, we can define them as always, making use of "<span class="negrita">def</span>" or if we want it to be of 
        global use we go to the <span class="inline-file">gradle file of the project</span> and add an <span class="negrita">ext</span>  object with the definition and value of the variables.</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">Gradle Project</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">buildscript <span class="token punctuation">{</span>
    ext <span class="token punctuation">{</span>
        room_version <span class="token operator">=</span> <span class="token string">'2.4.3'</span>
        recycler_version <span class="token operator">=</span> <span class="token string">'1.2.1'</span>
        lifecycle_version <span class="token operator">=</span> <span class="token string">'2.5.1'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

plugins <span class="token punctuation">{</span>
    <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>

    <h3>Directory structure</h3>
    
    <p>Next we are going to create some files, so as keep an eye on of where we are and to be more organized we are going to create the necessary packages.</p>
    

    <figure><img src="./Data persistence_files/ud7-2021-12-02-15-28-31.png"><br><figcaption>Dir structure</figcaption></figure>
    <br>
    
    <p>Note that <span class="d-word">MainActivity</span>  we have included it within a package called <span class="negrita">ui</span> , since it takes care of the view.
    We also have a package with everything related to data. We have the entities package, where we will define our model.
    We also have created two interfaces to implement the <span class="negrita">DAO</span>  and <span class="d-word">TaskDatabase</span>  pattern with the 
    creation and definition of the <span class="negrita">Room Database</span> .
    We have an adapters package where we will have the <span class="negrita">RecyclerView</span>  adapter and finally the viewmodel package where we will have our <span class="negrita">ViewModel</span> .</p>
    

    <h3>Starting to create files</h3>

    <p>Let's start, the first thing we will do is create our model or in <span class="negrita">Room</span> terminology the entity.</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">TaskEntity.kt</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Entity
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>PrimaryKey

<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string">"task_entity"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">TaskEntity</span> <span class="token punctuation">(</span>
    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-var">var</span> id<span class="token operator">:</span>Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-var">var</span> name<span class="token operator">:</span>String <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-var">var</span> isDone<span class="token operator">:</span>Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>

    <p>As we can see we use the <span class="negrita">Entity decorator</span> , which allows us to assign the name of the table that will contain our tasks entity.
    We can also see that we have defined an id attribute that will be the primary key and will also be generated by itself.
    Finally, <span class="d-word">TaskEntity</span>  has a task name and a <span class="cursiva">Boolean</span>  <span class="negrita">isDone</span>  attribute, which tells us if the task has been completed or not.</p>
    


    <p class="sub-section">Dao Pattern (Data Access Object)</p>
    
    <p>Now we are going to create the Dao pattern. Room defines its own <span class="negrita">Dao pattern</span> <span class="subrayado"> through decorators</span>, 
        but we will create a more generic interface in case we want to use another type of persistence such us Files. In this interface we will define the methods that we can use.</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">MyDao.kt</span>
        </section>
    <section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity

<span class="token keyword keyword-interface">interface</span> MyDao <span class="token punctuation">{</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">addTask</span><span class="token punctuation">(</span>taskEntity <span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Long <span class="token comment">//Id of the new  task</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">getTaskById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> TaskEntity

    <span class="token keyword keyword-fun">fun</span> <span class="token function">updateTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Int <span class="token comment">//Number of affected rows</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Int <span class="token comment">//Number of affected rows</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>
    </section>


    <p>As we can see, we have a method to recover all the tasks, another to recover a task given its ID, another to update a task and finally another to delete it.
    The last two methods return the number of rows affected in the operation.</p>
      
    
    <h3>RecyclerView</h3>

    <p>To continue we are going to implement the <span class="negrita">recyclerview</span>  part. The first thing is to add it to the layout of the main activity.
    We will also add a small form to add new tasks.</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">activity_main.xml</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>RelativeLayout xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    xmlns<span class="token operator">:</span>tools<span class="token operator">=</span><span class="token string">"http://schemas.android.com/tools"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>background<span class="token operator">=</span><span class="token string">"@android:color/background_light"</span>
    tools<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">"com.catata.tasknotesroom.ui.MainActivity"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>RecyclerView
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/rvTask"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_below<span class="token operator">=</span><span class="token string">"@+id/rlAddTask"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>RelativeLayout
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/rlAddTask"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>elevation<span class="token operator">=</span><span class="token string">"10dp"</span>
        android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"10dp"</span>
        android<span class="token operator">:</span>background<span class="token operator">=</span><span class="token string">"@android:color/white"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>EditText
            android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/etTask"</span>
            android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>hint<span class="token operator">=</span><span class="token string">"Add a Task"</span>
            android<span class="token operator">:</span>layout_alignParentLeft<span class="token operator">=</span><span class="token string">"true"</span>
            android<span class="token operator">:</span>layout_toLeftOf<span class="token operator">=</span><span class="token string">"@+id/btnAddTask"</span>
            <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button
            android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/btnAddTask"</span>
            android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>layout_alignParentRight<span class="token operator">=</span><span class="token string">"true"</span>
            android<span class="token operator">:</span>textAllCaps<span class="token operator">=</span><span class="token string">"false"</span>
            android<span class="token operator">:</span>backgroundTint<span class="token operator">=</span><span class="token string">"#FFAAAAAA"</span>
            android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"Add"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>RelativeLayout<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>RelativeLayout<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    

    <p>It is done with <span class="r-word">RelativeLayout</span>  but it could be done with any other Layout that we consider more comfortable.</p>
    

    <p>Next we are going to create the view adapter with its corresponding <span class="r-word">ViewHolder</span> .</p>
    

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">adapters/TaskAdapter.kt</span>
        </section>
    <section class="marco-b">
            <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>LayoutInflater
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>ViewGroup
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>CheckBox
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>RecyclerView
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>R
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity

<span class="token keyword keyword-class">class</span> <span class="token function">TasksAdapter</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> tasks<span class="token operator">:</span> List<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> checkTask<span class="token operator">:</span> <span class="token punctuation">(</span>TaskEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> deleteTask<span class="token operator">:</span> <span class="token punctuation">(</span>TaskEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>TasksAdapter<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ViewHolder <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> layoutInflater <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_task<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> ViewHolder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> item <span class="token operator">=</span> tasks<span class="token punctuation">[</span>position<span class="token punctuation">]</span>
        holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> checkTask<span class="token punctuation">,</span> deleteTask<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> tasks<span class="token punctuation">.</span>size


    <span class="token keyword keyword-class">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword keyword-val">val</span> tvTask <span class="token operator">=</span> view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tvTask<span class="token punctuation">)</span>
        <span class="token keyword keyword-val">val</span> cbIsDone <span class="token operator">=</span> view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>CheckBox<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>cbIsDone<span class="token punctuation">)</span>

        <span class="token keyword keyword-fun">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>task<span class="token operator">:</span> TaskEntity<span class="token punctuation">,</span> checkTask<span class="token operator">:</span> <span class="token punctuation">(</span>TaskEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">,</span> deleteTask<span class="token operator">:</span> <span class="token punctuation">(</span>TaskEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tvTask<span class="token punctuation">.</span>text <span class="token operator">=</span> task<span class="token punctuation">.</span>name
            cbIsDone<span class="token punctuation">.</span>isChecked <span class="token operator">=</span> task<span class="token punctuation">.</span>isDone
            cbIsDone<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">{</span><span class="token function">checkTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">}</span>
            itemView<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
            </section>
    </section>
    
    <p>As we can see in the constructor, we pass it a <span class="negrita">list of tasks</span>  and <span class="negrita">two callbacks</span> , one for when we click on the
         <span class="cursiva">Check box</span>  for the task performed and another for when we click on the entire element,
    in which case we would delete said task. In this case we create within the <span class="r-word">ViewHolder</span>  the bind function that does all this task.</p>


    <p>As you know, now we have to make tha layout for every item in the RecyclerView <span class="inline-file">item_task.xml</span> in the <span class="inline-folder">layout</span> dir, this layout could looks like this</p>

    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">item_task.xml</span>
        </section>
    <section class="marco-b">
               
    <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>LinearLayout xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
    xmlns<span class="token operator">:</span>tools<span class="token operator">=</span><span class="token string">"http://schemas.android.com/tools"</span>
    android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">"horizontal"</span>
    android<span class="token operator">:</span>layout_margin<span class="token operator">=</span><span class="token string">"10dp"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>CheckBox
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/cbIsDone"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_marginRight<span class="token operator">=</span><span class="token string">"10dp"</span>
        android<span class="token operator">:</span>layout_marginEnd<span class="token operator">=</span><span class="token string">"10dp"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>TextView
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/tvTask"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>textStyle<span class="token operator">=</span><span class="token string">"bold"</span>
        android<span class="token operator">:</span>textSize<span class="token operator">=</span><span class="token string">"18sp"</span>
        tools<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"Test"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>LinearLayout<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section>
    </section>
    

    <p>Before seeing how the MainActivity implementation would be, let's see how to implement the Database with Room.</p>


    <h3>Room</h3>
    
    <p>The <span class="negrita">Room library</span>  is an access layer to <span class="negrita">SQLite</span>  databases in Android applications. 
        Provides an easy way to create and access the database. <span class="subrayado">It uses object-relational mapping</span> , which consists of each row in a database 
        table corresponding to an object. It is also designed to easily integrate with the MVVM architecture.</p>
    

<p>To use the <span class="negrita">Room library</span>  you have to define 3 components:</p>

<ul>
    <li><span class="negrita">Database</span> : contains the reference to the database.</li>
    <li><span class="negrita">Entity</span>: represents a database table.</li>
    <li><span class="negrita">Dao</span>: It contains the methods with the queries to access the database. Will implement our dao MyDao</li>
</ul>

<p class="sub-section">TaskDao</p>
<p><span class="d-word">TaskDao</span>  will be the interface that will contain the queries to the database, we will implement our <span class="d-word">MyDao</span>  in it. 
    Here we will distinguish four kind of queries.</p>

<ul>
<li><span class="negrita">@Query:</span> Queries are made directly to the database, we will use SQL to do them. In this example we will do two very simple ones, but impressive things can be done.</li>
<li><span class="negrita">@Insert:</span> It will be used to insert entities into the database, unlike <span class="negrita">@Query</span> , you do not have to do any kind of query, but rather pass the object to insert.</li>
<li><span class="negrita">@Update:</span> They update an already inserted entity. We will only have to pass that modified object and it already takes care of updating it. 
    How do you know which object to modify? Well, because of our id (remember that it is the PrimaryKey).</li>
<li><span class="negrita">@Delete:</span>  As its name indicates, it deletes an object that we pass to it from the table.</li>
</ul>


<section class="marco-t file-">
    <span class="icono file"> </span> <span class="negrita">TaskDao.kt</span>
    </section>
<section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity

<span class="token annotation builtin">@Dao</span>
<span class="token keyword keyword-interface">interface</span> TaskDao<span class="token operator">:</span>MyDao <span class="token punctuation">{</span>
    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM task_entity"</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@Insert</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">addTask</span><span class="token punctuation">(</span>taskEntity <span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Long

    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM task_entity WHERE id LIKE :id"</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getTaskById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> TaskEntity

    <span class="token annotation builtin">@Update</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">updateTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Int

    <span class="token annotation builtin">@Delete</span>
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span><span class="token operator">:</span>Int
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>
</section>


<p class="sub-section">Database</p>

<p>To create the database, a class must be created that must:</p>

<ul>
    <li>Be abstract</li>
    <li>Extend <span class="negrita">RoomDatabase</span> </li>
    <li>Be annotated with <span class="negrita">@Database</span> </li>
    <li>Include the list of entities within the <span class="negrita">@Database</span>  annotation</li>
    <li>Contain an abstract method that returns the class annotated with <span class="negrita">@Dao</span> </li>
</ul>

<p>Inside the class, the static method <span class="r-word">Room.databaseBuilder ()</span>  is called <span class="subrayado">to obtain the reference to the database</span>.</p>


<p>It is convenient to use the <span class="negrita">singleton pattern</span> , which ensures that there will only be a single instance of the database.</p>


<p>Create the TaskDatabase.kt class:</p>


<section class="marco-t file-">
    <span class="icono file"> </span> <span class="negrita">TaskDatabase.kt</span>
    </section>
<section class="marco-b">
<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Database
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Room
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>RoomDatabase
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity

<span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>TaskEntity<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> TasksDatabase <span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">taskDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> TaskDao

    <span class="token keyword keyword-companion">companion</span> <span class="token keyword keyword-object">object</span><span class="token punctuation">{</span> <span class="token comment">//Singleton Pattern</span>
        <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-var">var</span> instance<span class="token operator">:</span>TaskDao<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword keyword-null">null</span>

        <span class="token keyword keyword-fun">fun</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span><span class="token operator">:</span>TaskDao<span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> instance <span class="token operator">?:</span> Room<span class="token punctuation">.</span><span class="token function">databaseBuilder</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> TasksDatabase<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token string">"tasks-db"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span> instance <span class="token operator">=</span> it <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>
</section>


<p>The first thing to look at is the <span class="negrita">@Database</span>  annotation, which specifies that the entity will be a list of <span class="d-word">TaskEntity</span> 
     (entity that we have already created) and that the <span class="negrita">version</span>  is 1.
Versions are used for possible data migration when updating the App.
Let's imagine that we release a second version of the app and instead of 3 parameters we store 4, we cannot change our entity at once because there would be problems.
For that, the version is used, together with a migration file that tells the program what it will have to do to go from version 1 to version 2, 3 or whatever.</p>


<p>We must also make sure that our class extends from <span class="r-word">RoomDatabase()</span>  which is a class that we have thanks to importing the <span class="negrita">Room</span> 
    dependency in our gradle.
Finally, it has a single function that refers to the <span class="negrita">DAO</span>  that we have created previously, if we had more Dao's then we would have to 
implement them there as well.</p>


<p>The database instance will need three parameters, the <span class="negrita">context</span>  (<span class="d-word">this</span> ), <span class="negrita">the class</span> 
     of our database (<span class="d-word">TasksDatabase</span> ) and the <span class="negrita">database name</span>  that we will give it, in this case we have called it "<span class="d-word">trasks-db</span>".</p>



<h3>ViewModel</h3>

<p>It is time to implement our <span class="r-word">ViewModel</span> , in this case we have chosen to create a <span class="r-word">LiveData</span> 
     for each of the methods implemented in the database.
These methods will give responses to the requests of the View (MainActivity + RecyclerView)</p>


<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-val">val</span> taskListLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>MutableList<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> updateTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>TaskEntity<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> deleteTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> insertTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>We have also added a <span class="d-word">myDao</span>  variable which is what we will use to implement the <span class="negrita">Dao pattern</span>. 
    In this case, we initialize it directly to the <span class="d-word">TaskDao</span>  of our <span class="d-word">TaskDatabase</span> .</p>


<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-var">var</span> myDao<span class="token operator">:</span>MyDao <span class="token operator">=</span> TasksDatabase<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p>Finally, we implement the 4 methods that we will need. These methods call the corresponding <span class="d-word">MyDao</span>  method within a <span class="negrita">Corroutine</span> 
     so as not to get in the way of the main thread.</p>


<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            taskListLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>myDao<span class="token punctuation">.</span><span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">add</span><span class="token punctuation">(</span>task<span class="token operator">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> id <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">addTask</span><span class="token punctuation">(</span><span class="token function">TaskEntity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-val">val</span> recoveryTask <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">getTaskById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
            insertTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>recoveryTask<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>task<span class="token operator">:</span>TaskEntity<span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword keyword-val">val</span> res <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">deleteTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>res<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                deleteTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span><span class="token punctuation">{</span>
                deleteTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>


        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>task<span class="token operator">:</span>TaskEntity<span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            task<span class="token punctuation">.</span>isDone <span class="token operator">=</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>isDone
            <span class="token keyword keyword-val">val</span> res <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">updateTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>res<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                updateTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span>
                updateTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>Note that the scope of the coroutine is viewModelScope since we are inside the viewmodel, so the coroutine will live, at most, as long as the viewmodel is alive.</p>

<p>The TaskViewModel class would look like this:</p>

<section class="marco-t file-">
    <span class="icono file"> </span> <span class="negrita">TaskViewModel.kt</span>
    </section>
<section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Application
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>lifecycle<span class="token punctuation">.</span>AndroidViewModel
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>lifecycle<span class="token punctuation">.</span>MutableLiveData
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>MyDao
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>TasksDatabase
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>CoroutineScope
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch

<span class="token keyword keyword-class">class</span> <span class="token function">TaskViewModel</span><span class="token punctuation">(</span>application<span class="token operator">:</span> Application<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">AndroidViewModel</span><span class="token punctuation">(</span>application<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> context <span class="token operator">=</span> application

    <span class="token keyword keyword-var">var</span> myDao<span class="token operator">:</span>MyDao <span class="token operator">=</span> TasksDatabase<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>

    <span class="token keyword keyword-val">val</span> taskListLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>MutableList<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> updateTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>TaskEntity<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> deleteTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-val">val</span> insertTaskLD<span class="token operator">:</span>MutableLiveData<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            taskListLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>myDao<span class="token punctuation">.</span><span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">add</span><span class="token punctuation">(</span>task<span class="token operator">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-val">val</span> id <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">addTask</span><span class="token punctuation">(</span><span class="token function">TaskEntity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-val">val</span> recoveryTask <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">getTaskById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
            insertTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>recoveryTask<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>task<span class="token operator">:</span>TaskEntity<span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword keyword-val">val</span> res <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">deleteTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>res<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                deleteTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span><span class="token punctuation">{</span>
                deleteTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>


        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>task<span class="token operator">:</span>TaskEntity<span class="token punctuation">)</span><span class="token punctuation">{</span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            task<span class="token punctuation">.</span>isDone <span class="token operator">=</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>isDone
            <span class="token keyword keyword-val">val</span> res <span class="token operator">=</span> myDao<span class="token punctuation">.</span><span class="token function">updateTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>res<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                updateTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
            <span class="token keyword keyword-else">else</span>
                updateTaskLD<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
</section>

<h3>MainActivity</h3>

<p>Now we only have to implement the View, the <span class="r-word">MainActivity</span>  code. Basically we will do the following:</p>


<ul>
    <li>Get an instance of our ViewModel.
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">taskViewModel <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>TaskViewModel<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
    </li>
    <li>Initially retrieve all saved tasks.
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">taskViewModel<span class="token punctuation">.</span><span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
    </li>
    <li>Create a listener for the add button.
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">binding<span class="token punctuation">.</span>btnAddTask<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>
    </li>
    <li>Observe all LiveData of the ViewModel.
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin">taskViewModel<span class="token punctuation">.</span>taskListLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
taskViewModel<span class="token punctuation">.</span>updateTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span> taskUpdated <span class="token operator">-&gt;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>taskUpdated <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token string">"Error updating task"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

taskViewModel<span class="token punctuation">.</span>deleteTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span>
            it<span class="token punctuation">.</span>id <span class="token operator">==</span> id
        <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword keyword-val">val</span> pos <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
        tasks<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
        recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyItemRemoved</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword keyword-else">else</span><span class="token punctuation">{</span>
        <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token string">"Error deleting task"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

taskViewModel<span class="token punctuation">.</span>insertTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyItemInserted</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span>size<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br><br>

<p>Notice that after modifying the task list we call the <span class="negrita">notifyItemInserted</span> , <span class="negrita">notifyItemRemoved</span> 
     or <span class="negrita">notifyDataSetChanged</span>  methods from adapter.</p>

    </li>
    <li>Configure our RecyclerView.
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-fun">fun</span> <span class="token function">setUpRecyclerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    adapter <span class="token operator">=</span> <span class="token function">TasksAdapter</span><span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token punctuation">{</span> taskEntity <span class="token operator">-&gt;</span>  <span class="token function">updateTask</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> taskEntity <span class="token operator">-&gt;</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    recyclerView <span class="token operator">=</span> binding<span class="token punctuation">.</span>rvTask
    recyclerView<span class="token punctuation">.</span><span class="token function">setHasFixedSize</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
    recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section><br><br>

    </li>
    <li>Add some extra function to hide Keyboard
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clearFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    binding<span class="token punctuation">.</span>etTask<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-val">val</span> inputMethodManager <span class="token operator">=</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span>Activity<span class="token punctuation">.</span>INPUT_METHOD_SERVICE<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> InputMethodManager
    inputMethodManager<span class="token punctuation">.</span><span class="token function">hideSoftInputFromWindow</span><span class="token punctuation">(</span>currentFocus<span class="token operator">?</span><span class="token punctuation">.</span>windowToken<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br><br>
    </li>
</ul>

<p>All the code would look like this.</p>

<section class="marco-t file-">
    <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
    </section>
<section class="marco-b">
        <section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Activity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>inputmethod<span class="token punctuation">.</span>InputMethodManager
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Toast
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>lifecycle<span class="token punctuation">.</span>ViewModelProvider
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>LinearLayoutManager
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>RecyclerView
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>TasksAdapter
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>database<span class="token punctuation">.</span>entities<span class="token punctuation">.</span>TaskEntity
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span>ActivityMainBinding
<span class="token keyword keyword-import">import</span> com<span class="token punctuation">.</span>catata<span class="token punctuation">.</span>tasknotesroom<span class="token punctuation">.</span>viewmodel<span class="token punctuation">.</span>TaskViewModel

<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> binding<span class="token operator">:</span> ActivityMainBinding
    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> recyclerView<span class="token operator">:</span> RecyclerView
    <span class="token keyword keyword-var">var</span> tasks<span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">mutableListOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> taskViewModel<span class="token operator">:</span>TaskViewModel

    <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> adapter<span class="token operator">:</span> TasksAdapter

    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>ActivityMainBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>
            binding <span class="token operator">=</span> it
        <span class="token punctuation">}</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>



        taskViewModel <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>TaskViewModel<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">]</span>

        taskViewModel<span class="token punctuation">.</span><span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        taskViewModel<span class="token punctuation">.</span>taskListLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            tasks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            tasks<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
            recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyDataSetChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        taskViewModel<span class="token punctuation">.</span>updateTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span> taskUpdated <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>taskUpdated <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token string">"Error updating task"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        taskViewModel<span class="token punctuation">.</span>deleteTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span>
                    it<span class="token punctuation">.</span>id <span class="token operator">==</span> id
                <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword keyword-val">val</span> pos <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>
                tasks<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
                recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyItemRemoved</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword keyword-else">else</span><span class="token punctuation">{</span>
                <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token string">"Error deleting task"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        taskViewModel<span class="token punctuation">.</span>insertTaskLD<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            tasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
            recyclerView<span class="token punctuation">.</span>adapter<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">notifyItemInserted</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span>size<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

        binding<span class="token punctuation">.</span>btnAddTask<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token function">setUpRecyclerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">showMessage</span><span class="token punctuation">(</span>s<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskViewModel<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>etTask<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">clearFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword keyword-fun">fun</span> <span class="token function">setUpRecyclerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        adapter <span class="token operator">=</span> <span class="token function">TasksAdapter</span><span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token punctuation">{</span> taskEntity <span class="token operator">-&gt;</span>  <span class="token function">updateTask</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> taskEntity <span class="token operator">-&gt;</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        recyclerView <span class="token operator">=</span> binding<span class="token punctuation">.</span>rvTask
        recyclerView<span class="token punctuation">.</span><span class="token function">setHasFixedSize</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">updateTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       taskViewModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span>taskEntity<span class="token operator">:</span> TaskEntity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskViewModel<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>taskEntity<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clearFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        binding<span class="token punctuation">.</span>etTask<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> Context<span class="token punctuation">.</span><span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-val">val</span> inputMethodManager <span class="token operator">=</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span>Activity<span class="token punctuation">.</span>INPUT_METHOD_SERVICE<span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> InputMethodManager
        inputMethodManager<span class="token punctuation">.</span><span class="token function">hideSoftInputFromWindow</span><span class="token punctuation">(</span>currentFocus<span class="token operator">?</span><span class="token punctuation">.</span>windowToken<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
        </section>
</section>

<br><br>

<p>You can get all the code in the following <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/RoomExample"> Github </a> link  </p>

<p><a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/RoomExampleLiveData">Here</a> you have the same example using <span class="negrita">Clean Architecture</span> 
     and <span class="d-word">LiveData</span>  directly from <span class="d-word">ROOM</span> </p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM task_entity"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
</section><br>

<p>And <a class="enlace" target="_blank" href="https://github.com/sdram58/EjemplosPMDM2223/tree/master/UD7/RoomExampleFlows">here</a>  you have the same example using 
    <span class="negrita">Clean Architecture</span>  and <span class="d-word">Flows</span>  directly from <span class="d-word">ROOM</span> </p>

<section><div class="code-toolbar"><pre class="language-kotlin line-numbers" tabindex="0"><code class="language-kotlin"><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM task_entity"</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>TaskEntity<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
    </section><br>



<div class="tarea">
    <span class="negrita">PRACTICE:</span> <br>
    
You have to implement a shopping list as indicated in the following <a class="enlace" name="practice5" target="_blank" href="https://sdram58.github.io/apuntesPMDM/unidades2223/UD7/Practice5_Shopping_List.pdf">document</a> . Remember that you have to use the Room library to save the elements, in addition to using the Dao and MVVM patterns, LiveData and Coroutines

</div>
    </section><!-- End section -->

    <!--*********************************************************Webgraphy***********************************************************-->
    <section class="apartado">
    <a name="sWebgrafia"></a>
    <h2>Webgraphy</h2>
    
    <ul>
        <li>
            <a class="enlace" target="_blank" href="https://developer.android.com/training/data-storage">Data Storage</a> 
        </li>
        <li><a class="enlace" target="_blank" href="https://developer.android.com/training/data-storage/shared-preferences">Shared Preferences</a> </li>
        <li><a class="enlace" target="_blank" href="https://developer.android.com/reference/androidx/preference/PreferenceFragmentCompat">https://developer.android.com/reference/androidx/preference/PreferenceFragmentCompat</a> </li>
        <li><a class="enlace" target="_blank" href="https://developer.android.com/guide/topics/ui/settings">https://developer.android.com/guide/topics/ui/settings</a> </li>
        <li><a class="enlace" target="_blank" href="https://cursokotlin.com/capitulo-17-persistencia-de-datos-con-room/">Room example</a> </li>
        <li><a class="enlace" target="_blank" href="https://gerardfp.github.io/room/">Room example</a> </li>
    </ul>
    
    </section><!-- End section -->



    <script src="./Data persistence_files/prism.js.descarga"></script>


</body></html>